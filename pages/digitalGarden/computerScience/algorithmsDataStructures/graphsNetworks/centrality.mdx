import Callout from "../../../../../components/Callout/Callout";
import Graph from "../../../../../components/Graph/Graph";

# Centrality

## Vertex Centrality

Vertex centrality measures can be used to determine the importance of a vertex in a graph. There are many different
vertex centrality measures, each with their own advantages and disadvantages. In a communication network a vertex with
high centrality is an actor that is important for the communication in the network, hence they are also often called
actor centrality measures. An actor with high centrality can control the flow of information in the network for good or
bad. They can also be used to determine key actors in a network, for example in a power grid it is important to know
which vertices are key actors, because if they fail, the whole network fails.

### Degree Centrality

The degree centrality is the simplest centrality measure. It is simply the number of edges connected to a vertex. The
degree centrality is a local measure, because it only takes into account the direct neighbors of a vertex. It can be
calculated using the $\text{deg()}$ function. Or alternatively using the $\text{indeg()}$ and $\text{outdeg()}$
depending on whether the graph is directed or not and the use-case.

export const vertexDegreeGraph = {
    nodes: [
        {id: 1, label: "2", x: 0, y: 0},
        {id: 2, label: "2", x: 0, y: 200},
        {id: 3, label: "3", x: 200, y: 100, color: "red"},
        {id: 4, label: "2", x: 400, y: 100},
        {id: 5, label: "3", x: 600, y: 100, color: "red"},
        {id: 6, label: "2", x: 800, y: 0},
        {id: 7, label: "2", x: 800, y: 200}
    ],
    edges: [
        {from: 1, to: 2},
        {from: 1, to: 3},
        {from: 2, to: 3},
        {from: 3, to: 4},
        {from: 4, to: 5},
        {from: 5, to: 6},
        {from: 5, to: 7},
        {from: 6, to: 7}
    ]
};

<Graph
    graph={vertexDegreeGraph}
    options={
        {
            physics: {
                enabled: false
            }
        }
    }
/>

The degree centrality can be normalized by dividing it by the maximum possible degree in the graph. This is rarely done
in practice, because a lot of values will be small, and we are most often interested in the actual degree of a vertex.

The interpretation of the degree centrality is pretty self-explanatory. And is closely related to the
[prestige](#prestige) of a vertex.

### Closeness Centrality

Unlike the degree centrality, the closeness centrality is a global measure, because it takes into account the whole
graph, however the consequence of this is that it is more expensive to calculate. The idea of the closeness centrality
is that a vertex is important if it is close to the center of the graph. So a vertex can be important as long as it is
close to the center of the graph, even if it only has one edge. As seen by the green vertex in the following graph.

export const vertexDegreeProblemGraph = {
    nodes: [
        {id: 1, label: "2", x: 0, y: 0},
        {id: 2, label: "2", x: 0, y: 200},
        {id: 3, label: "3", x: 200, y: 100, color: "red"},
        {id: 4, label: "2", x: 400, y: 100},
        {id: 5, label: "3", x: 600, y: 100, color: "red"},
        {id: 6, label: "2", x: 800, y: 0},
        {id: 7, label: "2", x: 800, y: 200},
        {id: 8, label: "1", x: 400, y: 0, color: "green"}
    ],
    edges: [
        {from: 1, to: 2},
        {from: 1, to: 3},
        {from: 2, to: 3},
        {from: 3, to: 4},
        {from: 4, to: 5},
        {from: 5, to: 6},
        {from: 5, to: 7},
        {from: 6, to: 7},
        {from: 4, to: 8},
    ]
};

<Graph
    graph={vertexDegreeProblemGraph}
    options={
        {
            physics: {
                enabled: false
            }
        }
    }
/>

<Callout type="info">
    This gives different values to the formula from wikipedia and networkx.
</Callout>

The closeness centrality for a vertex $v$ is calculated by taking the inverse distance of all shortest paths from the
vertex $v$ to all other vertices in the graph. This can be interpreted as how efficiently can all the other vertices
be reached from $v$. The formula for the closeness centrality is as follows:

$$
\text{closenessCentrality}(v) = \sum_{u \in V \setminus \{v\}}{d(v,u)^{-1}} = \sum_{u \in V \setminus \{v\}}{\frac{1}{d(v,u)}}
$$

Where $d(v,u)$ is the length of the shortest path from $v$ to $u$. Let us calculate the closeness centrality for the
green vertex in the graph above.

$$
\begin{align*}
1 + \frac{1}{2} + \frac{1}{2} + \frac{1}{2} + \frac{1}{3} + \frac{1}{3} + \frac{1}{3} + \frac{1}{3} &= \frac{10}{3} \\
\frac{10}{3} \cdot \frac{1}{8-1} &= \frac{10}{21} \approx 0.476
\end{align*}
$$

To normalize the closeness centrality, it can be divided by $|V| - 1$.

export const vertexClosenessGraph = {
    nodes: [
        {id: 1, label: "0.524", x: 0, y: 0},
        {id: 2, label: "0.524", x: 0, y: 200},
        {id: 3, label: "0.596", x: 200, y: 100},
        {id: 4, label: "0.714", x: 400, y: 100, color: "red"},
        {id: 5, label: "0.596", x: 600, y: 100},
        {id: 6, label: "0.524", x: 800, y: 0},
        {id: 7, label: "0.524", x: 800, y: 200},
        {id: 8, label: "0.476", x: 400, y: 0, color: "green"}
    ],
    edges: [
        {from: 1, to: 2},
        {from: 1, to: 3},
        {from: 2, to: 3},
        {from: 3, to: 4},
        {from: 4, to: 5},
        {from: 5, to: 6},
        {from: 5, to: 7},
        {from: 6, to: 7},
        {from: 4, to: 8},
    ]
};

<Graph
    graph={vertexClosenessGraph}
    options={
        {
            physics: {
                enabled: false
            }
        }
    }
/>

### Betweenness Centrality

In the above example using the degree centrality we saw that the green ones are the most important. However,
we can clearly visually see that the vertex inbetween them is the most important one as it connects the two communities.
Because of this we could say that that vertex is in Brokerage position or is a Broker/Gatekeeper of information.

![degreeCentralityIssue](/compSci/degreeCentralityIssue.png)

The betweenness centrality is a global measure that takes into account the whole graph and tries to solve the above
issue. The idea of the betweenness centrality is that a vertex is important if a lot of shortest paths go through it.

To calculate the betweenness centrality we need to calculate the number of shortest paths that go through a vertex $v$.
So for every pair of vertices $u$ and $w$ we need to calculate the shortest paths and then count how many of them go
through $v$. The formula for the betweenness centrality is as follows:

$$
\text{betweennessCentrality}(v) = \sum_{u \neq v \neq w}{\frac{\sigma_{uw}(v)}{\sigma_{uw}}}
$$

Where $\sigma_{uw}$ is the number of shortest paths from $u$ to $w$ and $\sigma_{uw}(v)$ is the number of shortest paths
from $u$ to $w$ that go through $v$.

<Callout type="info">
The fraction in the formula leads to the weight being split if there are multiple shortest paths between $u$ and $w$.
</Callout>

Because the calculations for the betweenness centrality are quite complex and take a while to calculate, we will use a
smaller graph to calculate the betweenness centrality.

<Callout type="todo">
    actual algo and steps for the result below
</Callout>

export const vertexBetweennessGraph = {
    nodes: [
        {id: 1, label: "0", x: 0, y: 200},
        {id: 2, label: "3", x: 200, y: 200},
        {id: 3, label: "1", x: 400, y: 0},
        {id: 4, label: "1", x: 400, y: 400},
        {id: 5, label: "0", x: 600, y: 200},
    ],
    edges: [
        {from: 1, to: 2},
        {from: 2, to: 3},
        {from: 2, to: 4},
        {from: 3, to: 4},
        {from: 3, to: 5},
        {from: 4, to: 5},
    ]
};

<Graph
    graph={vertexBetweennessGraph}
    options={
        {
            physics: {
                enabled: false
            }
        }
    }
/>

To normalize the betweenness centrality, you devide by the centrality by following:

- For an undirected graph: $\frac{(n-1)(n-2)}{2}$
- For a directed graph: $(n-1)(n-2)$

The Image below summarizes all the centrality measures we have seen so far and compares the most central vertices.

![betweennessCentrality](/compSci/betweennessCentrality.png)

### Eigenvector Centrality

<Callout type="todo">
    Do this
</Callout>

### Katz Centrality

<Callout type="todo">
    Do this
</Callout>

### PageRank

<Callout type="todo">
    Do this
</Callout>

### Prestige

In a directed Graph it is possible to analyze the prestige of a vertex, i.e the stature or reputation associated with
a vertex. The vertices relationships however need to resemble this. For example, if a person has a lot of followers
but doesn't follow a lot of people, then that person has a high prestige and stature, for example a celebrity.

#### Popularity

The simplest way to measure prestige is to count the number of incoming edges, i.e using the $\text{indeg()}$ function.
This is called popularity.


export const localGraph = {
    nodes: [
        {id: 1, label: "Bob, 1"},
        {id: 2, label: "Alice, 2"},
        {id: 3, label: "Michael, 4", color: "red"},
        {id: 4, label: "Urs, 2"},
        {id: 5, label: "Karen, 3"},
        {id: 6, label: "John, 2"},
        {id: 7, label: "Peter, 2"},
    ],
    edges: [
        {from: 1, to: 2},
        {from: 1, to: 3},
        {from: 1, to: 4},
        {from: 1, to: 5},
        {from: 2, to: 5},
        {from: 2, to: 6},
        {from: 2, to: 3},
        {from: 3, to: 4},
        {from: 3, to: 5},
        {from: 3, to: 6},
        {from: 3, to: 7},
        {from: 5, to: 1},
        {from: 5, to: 2},
        {from: 6, to: 3},
        {from: 6, to: 7},
        {from: 7, to: 3},
    ],
};

<Graph
    graph={localGraph}
    directed={true}
/>

#### Proximity Prestige

The proximity prestige measure does not just account for the number of directly incoming edges, but also the number of
indirectly incoming edges, i.e. the number of paths that lead to the vertex. However, the longer the path, the lower
prestige from that path is weighted.

So simply put the proximity prestige is the sum of all paths that lead to the vertex weighted by the length of the path.

The formula for the proximity prestige can be summarized pretty simply:

> The proximity prestige of a vertex is the number of vertices that have a path to the vertex divided by the average
path length leading to the vertex.

More formally:

$$
\text{proximityPrestige}(v) = \frac{\frac{|I|}{n-1}}{\frac{\sum_{i \in I}{d(i,v)}}{|I|}}
$$

Where $I$ is the set of all vertices that have a path to $v$ and $d(u,v)$ is the length of the shortest path from $u$ to
$v$.

<Callout type="todo">
    visualize proximity prestige with calculation
</Callout>

## Group Centrality

The goal of group centrality measures is to determine the importance of a group of vertices in a graph. These measures
are based on the vertex centrality measures, but they are more complex and expensive to calculate.

### Degree Group Centrality

The degree group centrality is the simplest group centrality measure. It is simply the fraction of the number of
vertices outside the group that are directly connected to the group. So in the following graph with the group $G$ being
defined as $G={v_6,v_7,v_8}$ the degree group centrality would be $\frac{3}{10}$ so $0.3$.

![degreeGroupCentrality](/compSci/degreeGroupCentrality.png)

### Closeness Group Centrality

The closeness group centrality measures how close the group is to the other vertices in the graph. It is calculted by
adding up all inverse distances from the vertices outside the group to the closest vertex in the group. So in the
same graph and group $G={v_6,v_7,v_8}$ as above the closeness group centrality would be:

$$
1+1+1+\frac{1}{2}+\frac{1}{2}+\frac{1}{2}+\frac{1}{2}+\frac{1}{2}+\frac{1}{2}+\frac{1}{3} = 6.333
$$

It can be simply normalized by dividing it by the number of vertices outside the group, which would lead to $0.6333$.

### Betweenness Group Centrality

The betweenness group centrality measures how many shortest paths go through the group. It is calculated by counting
how many shortest paths between all the vertices outside the group go through the group.

<Callout type="todo">
    visualize betweenness group centrality and calculations
</Callout>

## Network Centrality

The idea of network centrality is to measure the centrality of the entire network, i.e. to compare the difference in
centrality between the vertices in the network. The goal is then to show how different the key vertices are from the
rest of the network.

### General Network Centrality

To calculate the network centrality the vertex centrality measures are used. For this Linton Freeman defined a general
formula that returns a value between $0$ and $1$ with the following meanings:

- $0$ means that all vertices have the same centrality, i.e. the network is a ring network.
- $1$ means that one vertex has all the centrality, i.e. the network is a star network.

<Callout type="todo">
    ring and star network visualizations
</Callout>

The formula is as follows:

$$
\text{networkCentrality}(G) = \frac{\sum_{v \in V}{C_{max} - C(v)}}{Star_n}
$$

Where:
- $C(v)$ is the centrality function for a vertex $v$.
- $C_{max}$ is the maximum centrality of all vertices in the graph, i.e $ C_{max}= \argmax_{v \in V}{C(v)}$.
- The denominator $Star_n$ is the maximal sum of differences between
the centrality of a vertex and the maximum centrality of all vertices in the graph, i.e. if the graph was a star graph
with the same amount of vertices as the graph $G$, so $n=|V|$ (Is this always the case, no matter the centrality measure?).

With the definition above it is now logical why the value is $1$ when the graph is a star graph because the numerator and
denominator are the same. Whereas if the graph is a ring graph, i.e. all vertices have the same centrality, then the
sum of differences in the numerator is $0$ and the denominator is the maximum sum of differences, which leads to the
value being $0$.

<Callout type="warning">
    Depending on the definition of the general formula the Sum in the nominator skips the vertex with the maximum
    centrality since the difference would be $0$. I find the definition above more intuitive, but it is important to
    know that there are different definitions.
</Callout>

### Degree Network Centrality

For the degree network centrality the denominator is pretty simple, because for a star graph the key vertex will have a
degree of $n-1$ and the other vertices will have a degree of $1$. So the denominator is simply $(n-1)(n-2)$ for an
undirected Graph, if it is a directed Graph then the nominator can just be doubled.

If you are working with the normalized degree centrality, then the denominator can be even further simplified to just
$n-2$.

### Closeness Network Centrality

When using the normalized closeness centrality, the denominator is simply $\frac{n-2}{2}$. I will save you the details
just trust me bro.

### Betweenness Network Centrality

When using the normalized betweenness centrality, the denominator is simply $n-1$, just like with the degree centrality.
